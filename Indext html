<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MakGame PFC — Jouable + Dépôt/Retrait</title>
<style>
  *{box-sizing:border-box}
  body{font-family:Arial,Helvetica,sans-serif;background:#071225;color:#eef;padding:16px}
  .wrap{max-width:980px;margin:0 auto}
  header{display:flex;justify-content:space-between;align-items:center}
  h1{color:#34d399;margin:0}
  .card{background:#0b1630;padding:12px;border-radius:10px;margin-top:12px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .slot{width:120px;height:120px;border-radius:8px;background:#062034;display:flex;align-items:center;justify-content:center;font-size:48px}
  button{padding:8px 12px;border-radius:8px;border:0;background:#34d399;color:#022;cursor:pointer}
  .ghost{background:#113344;color:#9fb3b0}
  .choice{width:84px;height:84px;border-radius:8px;background:#0f2b44;display:flex;align-items:center;justify-content:center;font-size:30px;cursor:pointer}
  .sel{outline:3px solid rgba(110,240,200,0.12);transform:translateY(-6px)}
  input,textarea,select{padding:8px;border-radius:8px;border:0;background:#061225;color:#eef}
  .log{margin-top:10px;background:#061827;padding:8px;border-radius:6px;height:150px;overflow:auto;font-family:monospace}
  .muted{color:#9aa4b2;font-size:13px}
  .small{font-size:13px;color:#9aa4b2}
  .flex{display:flex;gap:8px;align-items:center}
  @media(max-width:740px){ .slot{width:100px;height:100px;font-size:40px} .choice{width:64px;height:64px;font-size:24px} }
  .numberBox{background:#fff6d9;color:#022;padding:10px;border-radius:8px;font-weight:700;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>MakGame — PFC + Dépôt/Retrait</h1>
      <div class="muted">Test local • prototype</div>
    </div>
    <div class="small">Solde: <span id="balance">0</span> FCFA</div>
  </header>

  <!-- AUTH + STAKE -->
  <div class="card">
    <div class="row">
      <label>Pseudo</label>
      <input id="pseudo" placeholder="TonPseudo">
      <button id="loginBtn">Connexion / Créer</button>
      <label>Mise</label>
      <input id="stake" type="number" value="300" style="width:120px">
      <button id="startBtn">Démarrer</button>
      <button id="resetBtn" class="ghost">Reset</button>
    </div>
    <div class="muted" style="margin-top:8px">Nouveau compte = crédit initial <b>0 FCFA</b></div>
  </div>

  <!-- GAME -->
  <div class="card" style="margin-top:12px">
    <div style="display:flex;gap:18px;align-items:center;justify-content:center">
      <div style="text-align:center">
        <div class="slot" id="playerSlot">—</div>
        <div class="small">Joueur</div>
      </div>
      <div style="text-align:center">
        <div class="slot" id="cpuSlot">—</div>
        <div class="small">Ordinateur</div>
      </div>
    </div>

    <div style="display:flex;gap:12px;justify-content:center;margin-top:12px">
      <div class="small">Joueur: <b id="pWins">0</b></div>
      <div class="small">Ordi: <b id="cWins">0</b></div>
      <div class="small">Round: <b id="round">0</b>/3</div>
    </div>

    <div style="margin-top:12px;text-align:center">
      <div style="display:inline-flex;gap:8px">
        <div class="choice" data-val="rock">✊</div>
        <div class="choice" data-val="paper">✋</div>
        <div class="choice" data-val="scissors">✌️</div>
      </div>
    </div>

    <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
      <button id="validateBtn" class="ghost" disabled>Valider le round</button>
    </div>

    <div class="log" id="gameLog">Aucun jeu pour l'instant.</div>
  </div>

  <!-- DEPOSIT / WITHDRAW -->
  <div class="card" style="margin-top:12px">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
      <div>
        <div style="font-weight:700">Dépôt</div>
        <div class="muted">Clique sur Dépôt pour afficher le numéro à envoyer</div>
      </div>
      <div class="flex">
        <button id="showNumberBtn" class="btn">Dépôt</button>
        <button id="openDepositForm" class="ghost">Soumettre preuve</button>
      </div>
    </div>

    <div id="numberArea" style="margin-top:12px;display:none">
      <div class="small">Envoie le montant à ce numéro :</div>
      <div class="numberBox" id="momoNumber">069527671</div>
      <div class="small" style="margin-top:6px">Référence : MG+[TON_PSEUDO] (ex: MG+ALICE)</div>
    </div>

    <div id="depositForm" style="margin-top:12px;display:none">
      <label class="small">Pseudo</label>
      <input id="depPseudo" placeholder="TonPseudo">
      <label class="small">Montant (FCFA)</label>
      <input id="depAmount" type="number" placeholder="Ex: 1000">
      <label class="small">Référence (ex: MG+ALICE)</label>
      <input id="depRef" placeholder="Référence">
      <label class="small">Preuve (capture) - optionnel</label>
      <input id="depProof" type="file" accept="image/*">
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="sendDepBtn" class="btn">Envoyer preuve</button>
        <button id="cancelDep" class="ghost">Annuler</button>
      </div>
      <div id="depMsg" class="small" style="margin-top:8px"></div>
    </div>

    <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)">

    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;flex-wrap:wrap">
      <div style="flex:1">
        <div style="font-weight:700">Retrait</div>
        <div class="muted">Demande un retrait — admin paiera manuellement</div>
      </div>
      <div style="flex:1;min-width:260px">
        <label class="small">Pseudo</label>
        <input id="wdPseudo" placeholder="TonPseudo">
        <label class="small">Montant (FCFA)</label>
        <input id="wdAmount" type="number" placeholder="Ex: 500">
        <label class="small">Numéro Mobile (où recevoir)</label>
        <input id="wdPhone" placeholder="+24206xxxxxxx">
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="reqWd" class="btn">Demander retrait</button>
          <button id="clearWd" class="ghost">Effacer</button>
        </div>
        <div id="wdMsg" class="small" style="margin-top:8px"></div>
      </div>
    </div>

    <div style="margin-top:12px">
      <div class="small">Demandes en attente (local)</div>
      <div id="pendingList" class="log">Aucune demande</div>
    </div>
  </div>

  <!-- ADMIN -->
  <div class="card" style="margin-top:12px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">Admin local</div>
      <div class="small">Code: <b>admin123</b></div>
    </div>
    <div style="margin-top:8px">
      <div class="flex">
        <input id="adminCode" placeholder="Code admin">
        <button id="openAdmin" class="btn">Ouvrir</button>
        <button id="closeAdmin" class="ghost">Fermer</button>
      </div>
      <div id="adminArea" style="display:none;margin-top:8px">
        <div class="small">Liste des demandes locales (dépôts & retraits)</div>
        <div id="adminList" class="log"></div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="approveBtn" class="btn">Approuver 1ère</button>
          <button id="rejectBtn" class="ghost">Refuser 1ère</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
/* Simple playable PFC + deposit/withdraw local (no server) */

// --- helpers & state ---
function $(id){ return document.getElementById(id); }
const choices = Array.from(document.querySelectorAll('.choice'));
let currentUser = null;
let users = JSON.parse(localStorage.getItem('mg_users')||'{}'); // {username:{balance:...}}
let deposits = JSON.parse(localStorage.getItem('mg_deposits')||'[]'); // {username,amount,ref,ts,status}
let withdrawals = JSON.parse(localStorage.getItem('mg_withdrawals')||'[]'); // {username,amount,phone,ts,status}
function saveAll(){ localStorage.setItem('mg_users', JSON.stringify(users)); localStorage.setItem('mg_deposits', JSON.stringify(deposits)); localStorage.setItem('mg_withdrawals', JSON.stringify(withdrawals)); }
function updateBalanceDisplay(){ $('balance').textContent = currentUser && users[currentUser] ? users[currentUser].balance : '0'; }
function now(){ return Date.now(); }
function emoji(k){ return k==='rock'?'✊':k==='paper'?'✋':'✌️'; }
function decide(p,c){ if(p===c) return 'draw'; if((p==='rock'&&c==='scissors')||(p==='paper'&&c==='rock')||(p==='scissors'&&c==='paper')) return 'win'; return 'lose'; }

// --- init UI refs
const playerSlot = $('playerSlot'), cpuSlot = $('cpuSlot'), pWinsEl = $('pWins'), cWinsEl = $('cWins'), roundEl = $('round'), validateBtn = $('validateBtn'), gameLog = $('gameLog');
const pseudoEl = $('pseudo'), loginBtn = $('loginBtn'), stakeEl = $('stake'), startBtn = $('startBtn'), resetBtn = $('resetBtn');
const showNumberBtn = $('showNumberBtn'), numberArea = $('numberArea'), openDepositForm = $('openDepositForm');
const depositForm = $('depositForm'), depPseudo = $('depPseudo'), depAmount = $('depAmount'), depRef = $('depRef'), depProof = $('depProof'), sendDepBtn = $('sendDepBtn'), cancelDep = $('cancelDep'), depMsg = $('depMsg');
const wdPseudo = $('wdPseudo'), wdAmount = $('wdAmount'), wdPhone = $('wdPhone'), reqWd = $('reqWd'), wdMsg = $('wdMsg'), pendingList = $('pendingList');
const adminCode = $('adminCode'), openAdmin = $('openAdmin'), closeAdmin = $('closeAdmin'), adminArea = $('adminArea'), adminList = $('adminList'), approveBtn = $('approveBtn'), rejectBtn = $('rejectBtn');

let game = {playing:false, round:0, pWins:0, cWins:0, stake:0, selected:null};

// --- load saved if any
(function(){ if(!localStorage.getItem('mg_users')) localStorage.setItem('mg_users', JSON.stringify({})); users = JSON.parse(localStorage.getItem('mg_users')||'{}'); deposits = JSON.parse(localStorage.getItem('mg_deposits')||'[]'); withdrawals = JSON.parse(localStorage.getItem('mg_withdrawals')||'[]'); const cur = localStorage.getItem('mg_current'); if(cur){ currentUser = cur; pseudoEl.value = cur; } updateBalanceDisplay(); renderPending(); renderAdminList(); })();

// --- auth
loginBtn.addEventListener('click', ()=>{
  const name = (pseudoEl.value||'').trim();
  if(!name){ alert('Entre un pseudo'); return; }
  currentUser = name;
  // **CHANGEMENT** : ne pas donner 1000 automatiquement — démarrage à 0
  if(!users[currentUser]) users[currentUser] = {balance:0};
  localStorage.setItem('mg_current', currentUser);
  saveAll(); updateBalanceDisplay(); alert('Connecté: ' + currentUser);
});

// --- game: selection
choices.forEach(c=> c.addEventListener('click', ()=>{ choices.forEach(x=>x.classList.remove('sel')); c.classList.add('sel'); game.selected = c.dataset.val; if(game.playing) validateBtn.disabled = false; }));

startBtn.addEventListener('click', ()=>{
  if(!currentUser){ alert('Connecte-toi'); return; }
  const stake = parseInt(stakeEl.value||0,10); if(!stake || stake<=0){ alert('Mise invalide'); return; }
  if(users[currentUser].balance < stake){ alert('Solde insuffisant'); return; }
  // debit
  users[currentUser].balance -= stake; saveAll(); updateBalanceDisplay();
  // init game
  game.playing=true; game.round=0; game.pWins=0; game.cWins=0; game.stake=stake; game.selected=null;
  playerSlot.textContent='—'; cpuSlot.textContent='—'; pWinsEl.textContent='0'; cWinsEl.textContent='0'; roundEl.textContent='0'; gameLog.textContent='Jeu lancé. Choisis ton coup, puis Valider le round.'; validateBtn.disabled = true;
});

validateBtn.addEventListener('click', ()=>{
  if(!game.playing){ alert('Appuie sur Démarrer'); return; }
  const p = game.selected || ['rock','paper','scissors'][Math.floor(Math.random()*3)];
  const cpu = ['rock','paper','scissors'][Math.floor(Math.random()*3)];
  const res = decide(p,cpu);
  playerSlot.textContent = emoji(p); cpuSlot.textContent = emoji(cpu);
  if(res==='win') game.pWins++; else if(res==='lose') game.cWins++;
  game.round++; pWinsEl.textContent = game.pWins; cWinsEl.textContent = game.cWins; roundEl.textContent = game.round;
  gameLog.textContent += `Round ${game.round}: ${p} vs ${cpu} → ${res}\n`;
  game.selected = null; choices.forEach(x=>x.classList.remove('sel')); validateBtn.disabled = true;
  if(game.round >= 3){
    game.playing=false;
    let outcome='draw'; if(game.pWins >= 2) outcome='win'; else if(game.cWins >= 2) outcome='lose';
    if(outcome==='win'){ const payout = game.stake * 2; users[currentUser].balance += payout; gameLog.textContent += `RESULTAT: Gagné +${payout} FCFA\n`; alert('Gagné +'+payout+' FCFA'); }
    else if(outcome==='draw'){ users[currentUser].balance += game.stake; gameLog.textContent += `RESULTAT: Match nul — mise remboursée\n`; alert('Match nul'); }
    else { gameLog.textContent += `RESULTAT: Perdu — mise perdue\n`; alert('Perdu'); }
    saveAll(); updateBalanceDisplay();
  }
});

resetBtn.addEventListener('click', ()=>{ game={playing:false,round:0,pWins:0,cWins:0,stake:0,selected:null}; playerSlot.textContent='—'; cpuSlot.textContent='—'; pWinsEl.textContent='0'; cWinsEl.textContent='0'; roundEl.textContent='0'; gameLog.textContent='Aucun jeu.'; validateBtn.disabled=true; });

// --- deposit UI
showNumberBtn.addEventListener('click', ()=>{ numberArea.style.display = numberArea.style.display === 'none' ? 'block' : 'none'; });

openDepositForm.addEventListener('click', ()=>{ depositForm.style.display = 'block'; depPseudo.value = currentUser || ''; depAmount.value=''; depRef.value=''; depMsg.textContent=''; });

cancelDep.addEventListener('click', ()=>{ depositForm.style.display='none'; });

sendDepBtn.addEventListener('click', async ()=>{
  const username = (depPseudo.value||'').trim(); const amount = parseInt(depAmount.value||0,10); const reference = (depRef.value||'').trim();
  if(!username || !amount || !reference){ depMsg.textContent = 'Remplis pseudo, montant et référence.'; return; }
  // proof optional: we won't upload, but note exists
  const entry = { username, amount, reference, proof: depProof.files && depProof.files[0] ? true : false, ts: now(), status: 'PENDING', type:'DEPOSIT' };
  deposits.unshift(entry); saveAll(); renderPending(); depositForm.style.display='none'; depMsg.textContent='Demande stockée localement. Admin devra vérifier.'; alert('Demande de dépôt enregistrée'); depProof.value='';
});

// --- withdraw
reqWd.addEventListener('click', ()=>{
  const username = (wdPseudo.value||'').trim(); const amount = parseInt(wdAmount.value||0,10); const phone = (wdPhone.value||'').trim();
  if(!username || !amount || !phone){ wdMsg.textContent='Remplis pseudo, montant et numéro.'; return; }
  if(!users[username] || users[username].balance < amount){ wdMsg.textContent='Solde insuffisant'; return; }
  // reserve by deducting immediately
  users[username].balance -= amount;
  const entry = { username, amount, phone, ts: now(), status:'PENDING', type:'WITHDRAW' };
  withdrawals.unshift(entry); saveAll(); renderPending(); updateBalanceDisplay(); wdMsg.textContent='Demande de retrait enregistrée (admin doit payer).'; alert('Demande de retrait créée'); wdPseudo.value=''; wdAmount.value=''; wdPhone.value='';
});

// --- pending/panel render
function renderPending(){
  const list = [];
  deposits.forEach((d,i)=> list.push(`${i+1}. [DEP] ${new Date(d.ts).toLocaleString()} • ${d.username} • ${d.amount} FCFA • ${d.reference} • ${d.status}`));
  withdrawals.forEach((w,i)=> list.push(`${i+1+deposits.length}. [WDR] ${new Date(w.ts).toLocaleString()} • ${w.username} • ${w.amount} FCFA • ${w.phone} • ${w.status}`));
  pendingList.textContent = list.length ? list.join('\n') : 'Aucune demande';
}

// --- admin
openAdmin.addEventListener('click', ()=>{ const code = (adminCode.value||'').trim(); if(code !== 'admin123'){ alert('Code admin incorrect'); return; } adminArea.style.display='block'; renderAdminList(); });
closeAdmin.addEventListener('click', ()=>{ adminArea.style.display='none'; });

function renderAdminList(){
  const lines = [];
  deposits.forEach((d,i)=> lines.push(`DEP ${i+1} • ${d.username} • ${d.amount}FCFA • ${d.reference} • ${d.status}`));
  withdrawals.forEach((w,i)=> lines.push(`WDR ${i+1} • ${w.username} • ${w.amount}FCFA • ${w.phone} • ${w.status}`));
  adminList.textContent = lines.length ? lines.join('\n') : 'Aucune demande';
}

approveBtn.addEventListener('click', ()=>{
  // approve first deposit if exists, else first withdraw (priority: deposit)
  if(deposits.length>0){
    const d = deposits.shift(); d.status='PAID'; // credit user
    users[d.username] = users[d.username] || {balance:0}; users[d.username].balance += d.amount; saveAll(); renderPending(); renderAdminList(); updateBalanceDisplay(); alert('Dépôt approuvé et solde crédité: ' + d.username + ' +' + d.amount);
    return;
  }
  if(withdrawals.length>0){
    const w = withdrawals.shift(); w.status='PAID'; // admin must have sent money externally
    saveAll(); renderPending(); renderAdminList(); alert('Retrait marqué PAYÉ pour ' + w.username + ' (' + w.amount + ' FCFA).');
    return;
  }
  alert('Aucune demande à approuver');
});

rejectBtn.addEventListener('click', ()=>{
  if(deposits.length>0){
    const d = deposits.shift(); d.status='REFUSED'; saveAll(); renderPending(); renderAdminList(); alert('Dépôt refusé');
    return;
  }
  if(withdrawals.length>0){
    const w = withdrawals.shift(); w.status='REFUSED';
    // on refund user if we earlier deducted
    users[w.username] = users[w.username] || {balance:0}; users[w.username].balance += w.amount; saveAll(); renderPending(); renderAdminList(); updateBalanceDisplay(); alert('Retrait refusé et solde remboursé');
    return;
  }
  alert('Aucune demande à refuser');
});

// update admin list whenever changes
setInterval(renderAdminList, 2000);
setInterval(renderPending, 2000);

// render initial
renderPending(); renderAdminList(); updateBalanceDisplay();

</script>
</body>
</html>
